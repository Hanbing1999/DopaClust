# Unsupervised Clustering for Putative Dopamine Neuron Identification from Tetrode Recordings

This repository contains MATLAB scripts and functions designed for unsupervised clustering of dopamine neurons based on their electrophysiological properties extracted from tetrode recordings. The primary focus is to differentiate putative dopamine (pDA) neurons from non-dopamine neurons by extracting key features and applying clustering techniques.

## Repository Contents

### Scripts and Functions

- **King_2.m**: Main script that calls various functions to preprocess the raw dataset and extract features.
- **RGSDetect.m**: Function to detect bursts and pauses in neuron firing.
- **ComputeCL.m**: Sub-function within `RGSDetect.m` to calculate additional metrics.
- **plot_ptt_new.m**: Computes peak-to-trough and repolarization time for action potentials.
- **plot_ptt_2.m**: Plots peak-to-trough and repolarization time.
- **plot_td_2.m**: Calculates the total duration of action potentials.
- **Rasterplot.m**: Plots all spikes along a time scale.
- **Clustering.m**: Main script for normalizing features, reducing dimensionality, and performing unsupervised clustering.
- **Clustering_plotting.m**: Plots the clustering results for analysis and visualization.
- **feature_table.m**: Generates a table with 38 extracted features.
- **test_stable.m**: Tests the stability of different clustering methods.

### Feature Table and Structure

The feature table consists of 58 features and a label that marks each neuron as photo-tagged (1) or non-identified (-1). The table includes:
- **Electrophysiological Features**: Peak-to-trough duration, repolarization time, total duration (at 80% amplitude), half-width, etc.
- **Burst Features**: 26 features related to bursts (mean, median, standard deviation, skewness, kurtosis, etc.).
- **Pause Features**: 26 features related to pauses.
- **Tonic Features**: Overall firing rates or other baseline characteristics.

### Data Processing and Clustering Workflow

1. **Preprocessing and Feature Extraction**:
   - Run `King_2.m` to preprocess the dataset and extract electrophysiological properties from tetrode recordings of ventral tegmental area (VTA) neurons.
   - Features extracted include waveform properties and firing patterns such as bursts and pauses.
   - Conducted Principal Component Analysis (PCA) to reduce the original 58 features to 38 principal components, retaining 99% of the variance.

2. **Clustering and Classification**:
   - Use `Clustering.m` to test various unsupervised clustering methods, including k-means, k-medoids, Gaussian Mixture Model (GMM), and DBSCAN, to identify additional putative dopamine (pDA) neurons that may have been missed by the opto-tagging technique.
   - After clustering, utilize `Clustering_plotting.m` to visualize the results and evaluate the clustering performance.
   - Trained a linear Support Vector Machine (SVM) classifier using the labels generated by the k-means clustering results, achieving a true positive rate of 95% and identifying 78% of pDA neurons in the testing dataset.

### FIGURE

The primary FIGURE includes comprehensive details about each neuron:
1. Cell name and identifiers.
2. Electrophysiological properties such as waveform and peak-to-trough duration.
3. Burst and pause characteristics, including:
   - Burst features: Mean, median, standard deviation, skewness, and kurtosis.
   - Pause features: Similar statistical measures.
4. Other details like repolarization time, total duration, half-width, tonic features, and whether the neuron is photo-identified.

### Table Structure (table_raw.m)

- **table_raw.m** saves the feature table along with training and testing samples for clustering.
- `{1,1}`: Contains a feature table with 37 features.
- `{2,1}`: Contains a feature table with 58 features.

### Features in the Table

1. `data_ttp`: Trough-to-peak duration (ms)
2. `data_rt`: Repolarization time (ms)
3. `td1s`: Total duration (ms)
4. `td2s`: Total duration at 80% amplitude (ms)
5. `hws`: Half-width (ms)
6-31. Burst features (26 metrics)
32-57. Pause features (26 metrics)
58. Tonic features
59. Mark (1 for photo-tagged, -1 for non-identified)

## To-Do List
1. Implement the Inverse Participation Ratio (IPR) for feature selection.

---

This project provides a robust framework for unsupervised clustering and characterization of neuron types based on electrophysiological data. Each function and script plays a specific role in the data processing pipeline, from feature extraction to clustering and visualization.


**************************************************************************************
## FIGURE: Main Cell Information

Each cell in the analysis contains the following attributes:

1. **Cell Names**: Unique identifier for each neuron.
2. **DAN.unref_avg_WF**: Average waveform of the neuron.
3. **DAN.best_unref_channel**: Name of the best channel for the neuron.
4. **Signals from the Best Channel**: Electrophysiological signals from the best channel.
5. **Photoidentified or Non-photoidentified**: Indicates if the neuron was photoidentified.
6. **Order of the Cell**: Sequence or order number in the dataset.
7. **Repolarization Time**: Time for the neuron to repolarize after an action potential.
8. **Total Duration 1**: Full duration of the action potential.
9. **Total Duration 2 (80% Amplitude)**: Duration at 80% of the action potentialâ€™s amplitude.
10. **Half-width**: Width of the action potential at half its maximum amplitude.
11. **Input Time Scale in Figure**: Time scale used in plotting.
12. **(Reserved for future use)**

### Additional Calculations and Features

13. **ptt (Peak-to-Trough Duration)**: Time between the peak and trough of the action potential.
14. **Bursts**: High-frequency spike groups within short intervals.
15. **Pauses**: Low-frequency spike groups within long intervals.
16. **Bursts Features**: Includes mean, median, standard deviation, skewness, and kurtosis of burst data matrix.
    - Matrix: `[Bursts_windows(s), Bursts_IBFs (Hz), Bursts_NumSpikes]`
17. **Percentage of Burst Windows** (`per_Bursts_windows`): Fraction of time in burst mode.
18. **Pauses Features**: Includes mean, median, standard deviation, skewness, and kurtosis of pause data matrix.
19. **Percentage of Pause Windows** (`per_Pauses_windows`): Fraction of time in pause mode.
20. **Bursts** (repeated): Additional computation of burst features.
21. **Pauses** (repeated): Additional computation of pause features.
22. **Bursts** (repeated for further calculations).
23. **Pauses** (repeated for further calculations).
24. **Tonics**: Characteristics of tonic firing outside of bursts and pauses.
25. **Burst Characteristics**: `[per_Bursts_windows, Bursts_ISIfeature', Bursts_spikefeature']`
26. **Pause Characteristics**: `[per_Pauses_windows, Pauses_ISIfeature', Pauses_spikefeature']`
27. **Percentage of Tonic Windows** (`per_Tonics_windows`): Fraction of time in tonic mode.
